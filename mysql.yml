---
- name: MySQL database
  hosts: dbserver
  vars_files:
    - vars.yml
  tasks:

    - name: Install MySQL packages
      ansible.builtin.dnf:
        name: "{{ packages }}"
        state: latest
      become: true

    - name: Start MySQL services
      ansible.builtin.service:
        name: "{{ item }}"
        state: started
        enabled: yes
      loop: "{{ services }}"
      become: true

    - name: Create MySQL users
      community.mysql.mysql_user:
        name: "{{ item.name }}"
        password: "{{ item.name }}"
        priv: "{{ item.name }}"
        host: "{{ item.name }}"
        state: present
      loop: "{{ users }}"
      notify: Restart MySQL services

    - name: Create MySQL databases
      community.mysql.mysql_db:
        name: "{{ databases }}"
        state: present


  handlers:

    - name: Restart MySQL services
      service:
        name: "{{ item }}"
        state: restarted
      loop: "{{ services }}"
